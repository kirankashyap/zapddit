<ng-template [ngIf]="tag !== undefined" [ngIfElse]="homefeedHeader">
  <h3 align="center">
    #{{ tag }}
    <ng-template [ngIf]="!isLoggedInUsingPubKey">
      <ng-template [ngIf]="!isTopicFollowed(tag)" [ngIfElse]="elseBlock">
        <button class="btn btn-sm btn-primary btn-icon" (click)="followTopic(tag)">
          <cds-icon shape="plus-circle" solid></cds-icon> Follow
        </button>
      </ng-template>
      <ng-template #elseBlock>
        <button class="btn btn-sm btn-warning-outline btn-icon" (click)="unfollowTopic(tag)">
          <cds-icon shape="logout" solid></cds-icon> Unfollow
        </button>
      </ng-template>
    </ng-template>
  </h3>
  <div align="center">
    <b>Sort: </b>  
    <clr-button-group [clrMenuPosition]="'bottom-right'" class="btn-sm">
        <clr-button class="btn btn-sm {{(currentSortName==='default-reverse-chrono'?'btn-primary':'')}}" (click)="switchBuffer('default-reverse-chrono')">New</clr-button>
        <clr-button *ngIf="advancedSortsAvailable" class="btn btn-sm {{(currentSortName==='top-votes-up-minus-down'?'btn-primary':'')}}" (click)="switchBuffer('top-votes-up-minus-down')">
          Top by Votes</clr-button>
        <clr-button *ngIf="advancedSortsAvailable" class="btn btn-sm {{(currentSortName==='best-votes-up-down-ratio'?'btn-primary':'')}}" (click)="switchBuffer('best-votes-up-down-ratio')">
          Best by Votes</clr-button>
        <clr-button *ngIf="advancedSortsAvailable" class="btn btn-sm {{(currentSortName==='hot-votes-times-time'?'btn-primary':'')}}" (click)="switchBuffer('hot-votes-times-time')">
            Hot by Votes</clr-button>
        <clr-button *ngIf="!advancedSortsAvailable" class="btn btn-sm" [clrInMenu]="true"(click)="advancedSortWarningModalOpen = true">Prepare advanced sorts</clr-button>
    </clr-button-group>
  </div>
  <div class="progress-block" *ngIf="preparingAdvanceSorts && advanceSortPreparationProgress<100">
    <label for="demoProgressBar">Preparing advanced sorts </label>
    <clr-progress-bar clrValue="{{advanceSortPreparationProgress}}" clrMax="100" [clrFade]="true" clrLabeled></clr-progress-bar>
  </div>
</ng-template>
<clr-modal [(clrModalOpen)]="advancedSortWarningModalOpen">
  <h3 class="modal-title">Are you sure?</h3>
  <div class="modal-body">
      <p>To prepare advanced sorts, I will fetch all reactions for maximum {{limit}} notes.</p>
      <p>I will do this work in the background while you continue to enjoy zapddit.</p>
  </div>
  <div class="modal-footer">
      <button type="button" class="btn btn-outline" (click)="advancedSortWarningModalOpen = false">Cancel</button>
      <button type="button" class="btn btn-primary" (click)="attemptPreparingAdvancedSorts()">Ok</button>
  </div>
</clr-modal>
<ng-template #homefeedHeader>
  <h3 align="center">
    üè° My Feed
  </h3>
  <div align="center">
    <b>Sort: </b>  
    <clr-button-group [clrMenuPosition]="'bottom-right'" class="btn-sm">
        <clr-button class="btn btn-sm {{(currentSortName==='default-reverse-chrono'?'btn-primary':'')}}" (click)="switchBuffer('default-reverse-chrono')">New</clr-button>
        <clr-button *ngIf="advancedSortsAvailable" class="btn btn-sm {{(currentSortName==='top-votes-up-minus-down'?'btn-primary':'')}}" (click)="switchBuffer('top-votes-up-minus-down')">
          Top by Votes</clr-button>
        <clr-button *ngIf="advancedSortsAvailable" class="btn btn-sm {{(currentSortName==='best-votes-up-down-ratio'?'btn-primary':'')}}" (click)="switchBuffer('best-votes-up-down-ratio')">
          Best by Votes</clr-button>
        <clr-button *ngIf="advancedSortsAvailable" class="btn btn-sm {{(currentSortName==='hot-votes-times-time'?'btn-primary':'')}}" (click)="switchBuffer('hot-votes-times-time')">
            Hot by Votes</clr-button>
        <clr-button *ngIf="!advancedSortsAvailable" class="btn btn-sm" [clrInMenu]="true"(click)="advancedSortWarningModalOpen = true">Prepare advanced sorts</clr-button>
    </clr-button-group>    
  </div>
  <div class="progress-block" *ngIf="preparingAdvanceSorts && advanceSortPreparationProgress<100">
    <label for="demoProgressBar">Preparing advanced sorts </label>
    <clr-progress-bar clrValue="{{advanceSortPreparationProgress}}" clrMax="100" [clrFade]="true" clrLabeled></clr-progress-bar>
  </div>
</ng-template>
<div *ngIf="(!tag) && followedTopics?.length == 0 && !events" class="clr-row clr-justify-content-center">
  <div align="center" class="alert alert-info clr-col-12 clr-col-md-8" role="alert">
    <div class="alert-items">
      <div class="alert-item static clr-justify-content-center">
        <div class="alert-icon-wrapper">
          <cds-icon class="alert-icon" shape="info-circle"></cds-icon>
        </div>
        <span class="alert-text">No topics followed yet. May be try following some topics? Like <a
            [routerLink]="['/t', 'coffeechain']">#coffeechain</a>?</span>
      </div>
    </div>
  </div>
</div>
<app-note-composer *ngIf="ndkProvider.canWriteToNostr" [currentTag]="tag" (postedEventEmitter)="addEventToFeed($event)"></app-note-composer>
<div align="center" *ngIf="events && events.size == 0">
  <div align="center" class="alert alert-info clr-col-12 clr-col-md-8" role="alert">
    <div class="alert-items">
      <div class="alert-item static clr-justify-content-center">
        <div class="alert-icon-wrapper">
          <cds-icon class="alert-icon" shape="info-circle"></cds-icon>
        </div>
        <span class="alert-text"> No notes for you ü•≤ May be try following more topics? Like <a
            [routerLink]="['/t', 'coffeechain']">#coffeechain</a>?
        </span>
      </div>
    </div>
  </div>
</div>
<div align="center" *ngIf="events && events.size == 0">
  Already following topics? It is possible that you could have muted topics from the preferences menu.
</div>
<ng-template [ngIf]="!loadingEvents">
  <div *ngFor="let event of events" class="clr-row clr-justify-content-center">
    <div class="clr-col-12 clr-col-md-8">
      <app-event-card [event]="event" [peopleIFollowLoadedFromRelay]="peopleIFollowLoadedFromRelay" />
    </div>
  </div>
</ng-template>
<ng-template [ngIf]="!loadingEvents && (tag || (followedTopics && followedTopics.length>0))">
  <div *ngIf="events && events.size>0 && !reachedEndOfFeed" align="center">
    <button [clrLoading]="loadingNextEvents" class="btn btn-info-outline" (click)="loadMoreEvents()">Load
      more</button>
  </div>
  <div *ngIf="reachedEndOfFeed" align="center" class="clr-row clr-justify-content-center">
    <div class="alert alert-info clr-col-3" role="alert">
      <div class="alert-items">
        <div class="alert-item static">
          <div class="alert-icon-wrapper">
            <cds-icon class="alert-icon" shape="check-circle"></cds-icon>
          </div>
          <span class="alert-text">Yaay! You reached the end of feed üòÅ</span>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<div *ngIf="loadingEvents" class="event-loading-spinner">
  <span class="spinner spinner-md">Loading notes...</span>
</div>
